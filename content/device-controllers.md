+++
title = "设备控制器"
date = 2020-08-12 17:50:29
[taxonomies]
tags = ["I/O", "principles of i/o hardware"]

+++
从功能角度方面，一个 `I/O` 单元由机械组件和电子组件两部分组合而成。而从设计的角度出发，将二者分开，则可以提供一种更具模块化，且更具通用性的设计模式。

电子组件，可被称作设备控制器(`device controller`)，也可被称作适配器 `(adapter)`。在个人计算机上，常见的设备控制器要么是直接在母板上的芯片，要么是可插入扩展插槽的印刷电路板。

机械组件其实就是设备本身。

下图为这种模块化的设计的简易示意图。

![arrangement](/images/device-controllers/01-devices-arrangement.PNG)

控制器卡上有一些连接器，用途是允许通过线缆连接到设备上，大部分控制器卡支持两个，四个甚至八个设备。控制器和设备之间的接口可以是标准接口，比如 `ANSI`，`IEEE` 或 `ISO` 标准，也可以是事实上的标准，例如，`SATA`，`SCSI`，`USB`，`Thunderbolt` 或 `FireWire(IEEE 1394)`。

控制器和设备之间的接口属于非常底层的接口。例如，磁盘可能被格式化为`2,000,000` 个扇区，每个磁道 `512` 字节。但是，实际上从驱动器中出来的是一个串行位流，始于前导码 `(preamble)`，然后是一个扇区中的 `4096` 位，最后是一个校验和或纠错码 `(ECC)`。格式化磁盘后，将写入包含柱面号和扇区号，扇区大小，类似数据以及同步信息的前导码。

控制器的职责是将串行位流转换为字节块，并执行必要的纠错。首先，控制器在其内部缓冲区中，逐位组装成字节块。在确认校验和无误，且该块无错误后，可以将数据块复制到主存储器中。

`LCD` 显示器的控制器在低电平时，可以用作位串行设备。它从存储器中读取包含要显示的字符的字节后，生成修改相应像素背光偏振的信号，实现将字符写入到屏幕上。试想，如果没有显示控制器，则需要操作系统开发者通过显式编程的方式，控制所有像素的电场，这将是一件多么可怕的事情。正是因为使用了控制器，操作系统只需通过少量参数来初始化控制器，例如每行的字符数，像素数以及每屏的行数，之后就可以让控制器来负责实际驱动电场。
